<tool id="mir_parser_2" name="Parse miRNA bowtie matching" version="2.0.0">
  <description></description>
  <requirements><requirement type='package'>bowtie-inspect</requirement></requirements>
  <parallelism method="basic"></parallelism>
  <command interpreter="python">mirparser.py $input $label $output1 $output2
                                             #if $refGenomeSource.genomeSource == "history":
                                                 $refGenomeSource.ownFile
                                                 --do_not_extract_index
                                              #else:
                                                 $refGenomeSource.index
                                                 --extract_index
                                              #end if

  </command>
  <inputs>
      <conditional name="refGenomeSource">
          <param name="genomeSource" type="select" label="Will you select a reference genome from your history or a PREVIOUSLY used built-in index?" help="Built-ins were indexed using default options">
             <option value="indexed">Use a built-in index</option>
             <option value="history">Use one from the history</option>
          </param>
          <when value="indexed">
             <param name="index" type="select" label="Select the reference genome used for the bowtie output" help="if your genome of interest is not listed - contact Christophe Antoniewski at drosofff@gmail.com">
                 <options from_data_table="ged_bowtie_ssRNA_indexes"></options>
             </param>
          </when>
          <when value="history">
              <param name="ownFile" type="data" format="fasta"  label="Select the fasta reference" />
           </when>
       </conditional>  <!-- refGenomeSource -->

     <param name="input" type="data" format="tabular" label="Bowtie tabular output" help="Bowtie output from miRbase matching"/>
     <param name="label" type="text" size="10" label="Library Label" help="Put the library label for easy subsequent data aggregation and DESeq analysis"/>
   </inputs>
   <outputs>
   <data format="tabular" name="output1" label= "Detailed miR report"/>
   <data format="tabular" name="output2" label="Straigth Hit List"/>
   </outputs>
  <help>

**What it does**

Bowtie_ is a short read aligner designed to be ultrafast and memory-efficient. It is developed by Ben Langmead and Cole Trapnell. Please cite: Langmead B, Trapnell C, Pop M, Salzberg SL. Ultrafast and memory-efficient alignment of short DNA sequences to the human genome. Genome Biology 10:R25.

.. _Bowtie: http://bowtie-bio.sourceforge.net/index.shtml

------

**Inportant restriction**

.. class:: warningmark

This is a very restricted usage of bowtie intented to match miRNA reads on a miRbase reference pre-indexed for bowtie.
The main option presets are -v 1 (allowing only one mismatch for alignments), -M 1 accompanied with --best and --strata, to match randomly the reads that may match to more that pre-miR sequence ("isomirs"), and --norc to match only on forward strands of pre-miRs. In addition the script is currently set up to run with to core processors (-p 2).
More documentation available at Bowtie webpages

.. _Bowtie: http://bowtie-bio.sourceforge.net/index.shtml

------

**Input formats**

.. class:: warningmark

*For simplicity, the only accepted format for this script is a raw fasta list of reads, after adapter clipping*

------


**Outputs**

The output is in standard bowtie output format, and has the following columns::

    Column    Description
  --------    --------------------------------------------------------   
   1 FastaID  fasta identifier
   2 miR      name of the miR
   3 Offset   O-based coordinate of the miR on the miRBase pre-miR sequence
   4 Seq      sequence of the matched Read


  </help>
</tool>
