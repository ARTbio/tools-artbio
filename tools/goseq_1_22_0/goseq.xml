<tool id="goseq" name="goseq" version="0.2.0">
    <description>tests for overrepresented gene categories</description>
    <macros>
        <import>go_macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <expand macro="stdio" />
    <command interpreter="Rscript">
        goseq.r --dge_file "$dge_file"
        --p_adj_column "$p_adj_column"
        --cutoff "$p_adj_cutoff"
        --length_file "$length_file"
        --category_file "$category_file"
        --wallenius_tab "$wallenius_tab"
        --sampling_tab "$sampling_tab"
        --nobias_tab "$nobias_tab"
        --length_bias_plot "$length_bias_plot"
        --sample_vs_wallenius_plot "$sample_vs_wallenius_plot"
        --repcnt "$repcnt"
        --use_genes_without_cat "$use_genes_without_cat"
        --make_plots "$make_plots"
    </command>
    <inputs>
        <param help="deseq2/edger/limma differential gene expression list" label="DGE list" name="dge_file" type="data" format="tabular" />
        <param help="Select the column that contains the multiple-testing corrected p-value" label="p adjust column" name="p_adj_column" type="data_column" numeric="true" data_ref="dge_file"/>
        <param label="Gene length file for length bias correction" help="You can calculate the gene length using the get length and gc content tool" name="length_file" type="data" format="tabular" required="true" />
        <param label="Gene category file" help="You can obtain a mapping of gene id to gene ontology using the getgo tool" name="category_file" type="data" format="tabular" required="true" />
        <param help="For example, a large number of gene may have no GO term annotated. If this option is set to FALSE, those genes will be ignored in the calculation of p-values. If this option is set to TRUE, then these genes will count towards the total number of genes outside the category being tested"
               name="use_genes_without_cat" label="Count genes without any category?" type="boolean"/>
        <param help="Typically 0.05 after multiple testing correction" max="1" label="Minimum p adjust value to consider genes as differentially expressed" name="p_adj_cutoff" type="float" value="0.05" />
        <param help="These plots may help you compare the different p-value estimation methods that goseq can use." label="Produce diagnostic plots?" name="make_plots" type="boolean"></param>
        <param help="Draw this many random control gene sets. Set to 0 to not do sampling. Larger values take a long time" label="sampling depth" name="repcnt" size="3" type="integer" min="0" max="10000" value="0" />
    </inputs>
    <outputs>
        <data format="pdf" label="length bias plot" name="length_bias_plot">
            <filter>make_plots</filter>
        </data>
        <data format="pdf" label="Plot P-value from sampling against wallenius distribution" name="sample_vs_wallenius_plot">
            <filter>repcnt != 0</filter>
            <filter>make_plots</filter>
        </data>
        <data format="tabular" label="Ranked category list - no length bias correction" name="nobias_tab" />
        <data format="tabular" label="Ranked category list - sampling" name="sampling_tab">
            <filter>repcnt != 0</filter>
        </data>
        <data format="tabular" label="Ranked category list - wallenius approx. of p-values" name="wallenius_tab" />
    </outputs>
    <tests>
        <test>
            <param name="dge_file" value="dge_list.tab" ftype="tabular"/>
            <param name="length_file" value="gene_length.tab" ftype="tabular"/>
            <param name="category_file" value="category.tab" ftype="tabular"/>
            <param name="use_genes_without_cat" value="true" />
            <param name="p_adj_column" value="2" />
            <output name="wallenius_tab" file="wal.tab" compare="contains"/>/>
        </test>
    </tests>
    <help>

        **What it does**

        Detects Gene Ontology and/or other user defined categories which are over/under-represented in RNA-seq data.

        Options map closely to the excellent manual_


        **Input files**

        goseq needs information about the length of a gene to correct for potential length bias in differentially expressed genes.
        The format of this file is tabular, with gene_id in the first column and length in the second column.
        The "get length and gc content" tool can produce such a file.

        You will also need a file describing the membership of genes in categories. The format of this file is gene_id in the first column,
        category name in the second column. If you are interested in gene ontology categories you can use the getgo file to retrive
        gene ontologies for model organisms, or you can construct your own file.

        .. _manual: https://bioconductor.org/packages/release/bioc/vignettes/goseq/inst/doc/goseq.pdf


    </help>
    <citations>
        <citation type="doi">10.1186/gb-2010-11-2-r14</citation>
    </citations>
</tool>
