<tool id="create_collection" name="Create_dataset_collection" version="0.3.0">
  <description>of type list</description>
  <stdio>
      <exit_code range="1:" level="fatal" description="Tool exception" />
  </stdio>
  <command detect_errors="exit_code"><![CDATA[
       mkdir outputs; cd outputs;
       #set names={}#
       #for $input in $input_list#
         #set $file_name =$input.name#
           #if $file_name in $names#
             #silent $names[$file_name] = $names[$file_name] + 1#
             #set $file_name = ''.join([$file_name,'(',str($names[$file_name]-1),')'])#
           #else#
             #silent $names[$file_name] = 0#
           #end if#
         echo "$file_name" >> $log;
         ln  -s  $input "$file_name.$input.ext.$input.dbkey";
       #end for#
       ls ;
  ]]></command>
  <inputs>
      <param name="list_label" type="text" label="Collection label"
          help="Label the collection should be given." value="Collection label">
          <validator type="length" min="1" max="50"/>
      </param>
      <param name="input_list" type="data" label="Input datasets"
          multiple="true" help="Datasets to create a collection with." />
  </inputs>
  <outputs>
      <data format="txt" name="log" label="Create list log"/>
      <collection name="output_list" type="list" label="${list_label}">
          <discover_datasets pattern="(?P&lt;name&gt;.+)\.(?P&lt;ext&gt;[^\._]+)\.(&lt;dbkey&gt;.*)?" directory="outputs" visible="false"/>
      </collection>
  </outputs>
  <tests>
      <test>
          <param name="list_label" value="Collection test"/>
          <param name="input_list" value="file1.txt,file2.txt,diff.txt"/>
          <output_collection name="output_list" type="list">
              <element name="file1.txt">
                  <assert_contents>
                      <has_text text="Je fais souvent ce reve etrange"/>
                  </assert_contents>
              </element>
              <element name="file2.txt">
                  <assert_contents>
                      <has_text text="Il fait souvent ce reve etrange"/>
                  </assert_contents>
              </element>
              <element name="diff.txt">
                  <assert_contents>
                      <has_text text="1c1"/>
                  </assert_contents>
              </element>
          </output_collection>
      </test>
  </tests>
  <help>

.. class:: warningmark
      
*NOTE*: Be advised, to use this tool in workflows. And prioritize the use of the normal 'checkbox in dataset history' tool otherwise.
      
.. class:: infomark

**What it does**

Creates a dataset collection of type list.

.. class:: warningmark
      
      + The tool was designed to be used in a workflow. Prioritize the use of the checkbox in dataset history when creating collections when not in a workflow.
      + This tool will keep the datasets formats but won't keep the datasets reference genome.
      
**Inputs**

Takes any dataset (as a data format).

**Outputs**
      
+ A **list** type dataset collection.
+ A log file containing the names of the datasets contained in the colection.
      
  </help>
</tool>

