<tool id="center_scale" name="Center or scale (standardize) data" version="0.1.0">
    <description></description>
    <requirements>
        <requirement type="package" version="1.6.0">r-optparse</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" level="fatal" description="Tool exception" />
    </stdio>
    <command detect_errors="exit_code"><![CDATA[ 
        Rscript $__tool_directory__/center_scale.R 
            --data '$input'
            --center '$center'
            --scale '$scale'
            #if $factor.factor_options == 'TRUE':
               --factor '$file'
            #end if
            --output '$output'
]]></command>
    <inputs>
        <param name="input" type="data" format="tabular" label="Input file with values to transform"
               help="Must be tabular separated with columns and row names, variables in rows, observations in columns" />
        <param name="center" type="select" label="Center data to mean">
            <option value="TRUE" selected="true">Yes</option>
            <option value="FALSE">No</option>
        </param>
        <param name="scale" type="select" label="Scale data to standard deviation">
            <option value="TRUE" selected="true">Yes</option>
            <option value="FALSE">No</option>
        </param>
        <conditional name="factor">
            <param name="factor_options" type="select" label="group data by factor ?">
                <option value="TRUE">Yes</option>
                <option value="FALSE" selected="true">No</option>
            </param>
            <when value="TRUE">
                <param name="file" type="data" format="tabular" label="Grouping map"
                       help="A two-column observation|factor_level table that assigns group ids to observations" /> 
            </when>
            <when value="FALSE">
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="output" format="tabular" label="scale ${on_string}" />
    </outputs>
    <tests>
        <test>
            <param name="input" value="mini.data.counts.tsv" ftype="tabular"/>
            <output name="output" file="full_standardize.tab" ftype="tabular"/>
        </test>
        <test>
            <param name="input" value="mini.data.counts.tsv" ftype="tabular"/>
            <param name="scale" value="FALSE"/>
            <output name="output" file="full_center.tab" ftype="tabular"/>
        </test>
        <test>
            <param name="input" value="mini.data.counts.tsv" ftype="tabular" />
            <param name="factor_options" type="TRUE" />
            <param name="file" value="mini.data.factor.tsv" ftype="tabular" />          
            <output name="output" file="group_standardize.tab" ftype="tabular"/>
        </test>
        <test>
            <param name="input" value="mini.data.counts.tsv" ftype="tabular" />
            <param name="scale" value="FALSE"/>
            <param name="factor_options" type="TRUE" />
            <param name="file" value="mini.data.factor.tsv" ftype="tabular" />          
            <output name="output" file="center_standardize.tab" ftype="tabular"/>
        </test>
    </tests>
    <help>

**What it does**

Takes a raw count expression matrix and returns a table of normalized expression values.

Normalization can be:

- CPM (Counts Per Million) are obtained by dividing counts by the library counts sum and multiplying the results by a million.
- RPK (Reads Per Kilobases) are obtained by dividing read counts by gene lengths (expressed in kilo-nucleotides).
- TPM (Transcripts Per Million) are obtained by dividing RPK values by the sum of all RPK values in a sample and multiplying the results by 1 million.

RPK and TPM require a two-column correspondance table gene_name - gene length where the length is specified in nucleotide. Both these metrics are relevant only for sequencing of full length RNAs.

Note: First header row must NOT start with a '#' comment character

Computed values may be base-2 log-transformed (log2([CPM or RPK or TPM]+1))

    </help>
    <citations>
        <citation type="bibtex">
        @Manual{,
             title = {R: A Language and Environment for Statistical Computing},
             author = {{R Core Team}},
             organization = {R Foundation for Statistical Computing},
             address = {Vienna, Austria},
             year = {2014},
             url = {http://www.R-project.org/},
        }
        </citation>
    </citations>
</tool>
