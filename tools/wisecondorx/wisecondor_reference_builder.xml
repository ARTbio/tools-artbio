<tool id="wisecondorx_reference_builder" name="WisecondorX build" version="@WRAPPER_VERSION@" profile="@PROFILE@">
    <description>
        reference
    </description>
    <macros>
        <import>macro.xml</import>
    </macros>
    <expand macro="requirements"/>
    <stdio>
        <exit_code range="1:" level="fatal" description="Error occured" />
    </stdio>
    <command detect_errors="exit_code"><![CDATA[
    @pipefail@
    #for $num, $file in enumerate($npz_inputs):
        printf "$num\n" &&
        ln -s $file "${num}.npz" &&
    #end for
    WisecondorX newref *.npz reference.npz
        --binsize ${bin}
        --cpus \${GALAXY_SLOTS:-4} &&
    mv reference.npz $npz
    ]]></command>
    <inputs>
        <param name="npz_inputs" type="data" label="npz inputs" multiple="True" format="npz"
               help="Build reference from npz inputs from normal sample (at least 10 samples required)"/>
        <param name="bin" size="9" type="integer" value="100000" label="Bin size in nucleotides"
               help="Bin default value is 100 kb (100000)" />
     </inputs>
    <outputs>
        <data name="npz" format="npz" label="reference_${bin}nt" />
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="npz_inputs">
                <collection type="list">
                    <element name="0" ftype="npz" value="0.ref.npz"/>
                    <element name="1" ftype="npz" value="1.ref.npz"/>
                    <element name="2" ftype="npz" value="2.ref.npz"/>
                    <element name="3" ftype="npz" value="3.ref.npz"/>
                    <element name="4" ftype="npz" value="4.ref.npz"/>
                    <element name="5" ftype="npz" value="5.ref.npz"/>
                    <element name="6" ftype="npz" value="6.ref.npz"/>
                    <element name="7" ftype="npz" value="7.ref.npz"/>
                    <element name="8" ftype="npz" value="8.ref.npz"/>
                    <element name="9" ftype="npz" value="9.ref.npz"/>
                </collection>
            </param>
            <param name="bin" value="100000" />
            <output name="npz" ftype="npz" file="output_reference.npz" compare="sim_size" delta="1"/>
        </test>
    </tests>
    <help>

WisecondorX build reference
============================

Generate reference npz index from npz control samples.

Inputs
--------

A collection of .npz files (at least 10 files or more)

    </help>
    <citations>
        <citation type="doi">10.1093/nar/gky1263</citation>
    </citations>
</tool>
