<tool id="single_cell_gene_expression_correlations" name="single_cell_gene_expression_correlations" version="0.1.0">
    <description>between genes or with a signature of selected genes</description>
    <requirements>
        <requirement type="package" version="1.3.2=r3.3.2_0">r-optparse</requirement>
        <requirement type="package" version="4.0_3=r3.3.2_0">r-hmisc</requirement>
        <requirement type="package" version="0.14.1=r3.3.2_0">r-heatmaply</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" level="fatal" description="Tool exception" />
    </stdio>
    <command detect_errors="exit_code"><![CDATA[ 
        Rscript $__tool_directory__/correlation_with_signature.R 
            --expression_file '$expression_file'
            --signatures_file '$signatures_file'
            --DE_genes '$DE_genes'
            --score_header '$score_header'
            --sep 
            #if $sep == 'tab':
              'tab'
            #elif $sep == 'comma':
              'comma'
            #end if
            --colnames '$colnames'
            --sig_corr '$sig_corr'
            --gene_corr '$gene_corr'
            --gene_corr_pval '$gene_corr_pval' &&
        mv 'plot.html' '$plot'
]]></command>
    <inputs>
        <param name="expression_file" type="data" format="txt" label="Expression data"
               help="a csv or tsv file that contains log2(CPM +1) expression values" />
        <param name="signatures_file" type="data" format="txt" label="signature values"
               help="a csv or tsv file that contains cell signatures" />
        <param name="score_header" value="Score" type="text" label="Column name for the signature score"
               help="Column name for the signature scores in the cell signatures file" />
        <param name="DE_genes" type="data" format="txt" label="selected genes"
               help="a csv or tsv file that contains selected genes (for instance,
               differentially expressed genes)" />
        <param name="sep" type="select" label="Indicate column separator"
               help="Note that all input files must have the same format">
            <option value="tab" selected="true">Tabs</option>
            <option value="comma">Comma</option>
        </param>
        <param name="colnames" type="select" label="Firt row contains column names"
               help="chose whether your files contain a header row (often a good idea)" >
            <option value="TRUE" selected="true">True</option>
            <option value="FALSE">False</option>
        </param>
    </inputs>
    <outputs>
        <data name="sig_corr" format="tabular" label="Signature correlations from ${on_string}" />
        <data name="gene_corr" format="tabular" label="Genes-genes correlations from ${on_string}" />
        <data name="gene_corr_pval" format="tabular" label="genes-genes correlations pvalues from ${on_string}" />
        <data name="plot" format="html" label="PLOT" />
    </outputs>
    <tests>
        <test>
            <param name="expression_file" value="gene_filtered_input.tsv" ftype="txt"/>
            <param name="signatures_file" value="signature.tsv" ftype="txt"/>
            <param name="DE_genes" value="DEtest.tsv" ftype="txt"/>
            <param name="sep" value='tab' />
            <param name="colnames" value="TRUE"/>
            <param name="score_header" value="Signature_score"/>
            <output name="sig_corr" file="sig_corr.tsv" ftype="tabular"/>
            <output name="gene_corr" file="gene_corr.tsv" ftype="tabular"/>
            <output name="gene_corr_pval" file="gene_corr_pval.tsv" ftype="tabular"/>
            <output name="plot" file="plot.html" ftype="html" compare="sim_size" delta="500" />
        </test>
    </tests>
    <help>

**What it does**

Under construction

The tools takes a table of gene expression values (e.E. log10(CPM+1), etc...)
from single cell RNAseq sequencing libraries (columns) and filters out genes (rows) that
are detected in less than the specified fraction of libraries.


The tools returns a gene expression table for genes that were retained.

**Input**

A table of comma (csv) or tabulation (tsv) separated values.
Gene names should be in the first column and cell names should be in the first row.
Note that in a number of a csv files, header of the gene column is omitted, resulting in
a first row with one item less than in other rows. Although this is not recommended, the tool
handles this type of table and will return a filtered table with the same structure.

    </help>
    <citations>
        <citation type="bibtex">
        @Manual{,
             title = {R: A Language and Environment for Statistical Computing},
             author = {{R Core Team}},
             organization = {R Foundation for Statistical Computing},
             address = {Vienna, Austria},
             year = {2014},
             url = {http://www.R-project.org/},
        }
        </citation>
    </citations>
</tool>
