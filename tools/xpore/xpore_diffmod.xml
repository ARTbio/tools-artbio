<tool id="xpore_diffmod" name="xpore-diffmod" version="0.5.6+galaxy0">
  <description></description>
  <requirements>
        <requirement type="package" version="0.5.6">xpore</requirement>
        <requirement type="package" version="1.9.0">pyensembl</requirement>
  </requirements>
  <stdio>
      <exit_code range="1:" level="fatal" description="Tool exception" />
  </stdio>
  <command detect_errors="exit_code"><![CDATA[
    printf "notes: Pairwise comparison without replicates with default parameter setting.\n\n" >> config.yml &&
    printf "data:\n" >> config.yml &&
    printf "    ${control_name}:\n" >> config.yml &&
    #for $i, $s in enumerate($ControlReplicates):
        printf "        rep${i}: ./${control_name}_${i}\n" >> config.yml &&
        mkdir $control_name_${i} &&
        ln -s ${s.ControlJson} $control_name_${i}/data.json &&
        ln -s ${s.ControlIndex} $control_name_${i}/data.index &&
        ln -s ${s.ControlReadcount} $control_name_${i}/data.readcount &&
    #end for
    printf "    ${test_name}:\n" >> config.yml &&    
    #for $i, $s in enumerate($TestReplicates):
        printf "        rep${i}: ./${test_name}_${i}\n" >> config.yml &&
        mkdir $test_name_${i} &&
        ln -s ${s.TestJson} $test_name_${i}/data.json &&
        ln -s ${s.TestIndex} $test_name_${i}/data.index &&
        ln -s ${s.TestReadcount} $test_name_${i}/data.readcount &&
    #end for
    printf "\nout: ./out\n" >> config.yml &&
    printf "\nmethod:\n" >> config.yml &&
    printf "    prefiltering:\n" >> config.yml &&
    printf "        method: t-test\n" >> config.yml &&
    printf "        threshold: 0.1\n" >> config.yml &&

    xpore-diffmod --config config.yml  --n_processes \${GALAXY_SLOTS:-4} &&
    tree . &&
    sed -i "s/,/\t/g" .out/diffmod.table

  ]]></command>
 <inputs>
    <section name="Controls" title="Control Condition" >
        <param name="control_name" type="text" label="Control condition name"
               help="Only letters, digits and _ will be retained in this field">
            <sanitizer>
                <valid initial="string.letters,string.digits"><add value="_" /></valid>
            </sanitizer>
        </param>
        <repeat name="ControlReplicates" title="Control replicates" min="1">
            <param name="ControlJson" label="json from xpore-dataprep" type="data" format="json" />
            <param name="ControlIndex" label="index from xpore-dataprep" type="data" format="txt" />
            <param name="ControlReadcount" label="Readcount from xpore-dataprep" type="data" format="txt" />
        </repeat>
    </section>

    <section name="Tests" title="Test Condition" >
        <param name="test_name" type="text" label="Test condition name"
               help="Only letters, digits and _ will be retained in this field">
                <sanitizer>
                    <valid initial="string.letters,string.digits"><add value="_" /></valid>
                </sanitizer>
        </param>
        <repeat name="TestReplicates" title="Test replicates" min="1">
            <param name="TestJson" label="json from xpore-dataprep" type="data" format="json" />
            <param name="TestIndex" label="index from xpore-dataprep" type="data" format="txt" />
            <param name="TestReadcount" label="Readcount from xpore-dataprep" type="data" format="txt" />
        </repeat>
    </section>

 </inputs>

 <outputs>
    <data format="tabular" name="diffmod_table" label="diffmod table" from_work_dir="./out/diffmod.table" />
    <data format="txt" name="diffmod_log" label="diffmod log" from_work_dir="./out/diffmod.log" />
</outputs>
<tests>
    <test> 
        <repeat name="ControlReplicates">
            <param name="ControlJson" value="inputs_xpore-diffmod/C1_data.json" ftype="json" />
            <param name="ControlIndex" value="inputs_xpore-diffmod/C1_data.index" ftype="txt" />
            <param name="ControlReadcount" value="inputs_xpore-diffmod/C1_data.readcount" />
        </repeat>
        <repeat name="ControlReplicates">
            <param name="ControlJson" value="inputs_xpore-diffmod/C2_data.json" ftype="json" />
            <param name="ControlIndex" value="inputs_xpore-diffmod/C2_data.index" ftype="txt" />
            <param name="ControlReadcount" value="inputs_xpore-diffmod/C2_data.readcount" ftype="txt" />
        </repeat>
        <repeat name="TestReplicates">
            <param name="TestJson" value="inputs_xpore-diffmod/T1_data.json" ftype="json"/>
            <param name="TestIndex" value="inputs_xpore-diffmod/T1_data.index" ftype="txt" />
            <param name="TestReadcount" value="inputs_xpore-diffmod/T1_data.readcount" ftype="txt" />
        </repeat>
        <repeat name="TestReplicates">
            <param name="TestJson" value="inputs_xpore-diffmod/T2_data.json" ftype="json"/>
            <param name="TestIndex" value="inputs_xpore-diffmod/T2_data.index" ftype="txt" />
            <param name="TestReadcount" value="inputs_xpore-diffmod/T2_data.readcount" ftype="txt" />
        </repeat>
        <output file="diffmod.table" name="diffmod_table" />
    </test>
</tests>
<help>

**What it does**

Creates a tar.gz archive of fast5 (h5) sequences files

.. class:: warningmark

This tools follows a "map-reduce" procedure: multiple inputs, that can be arranged as a data collection,
are compressed into a single tar.gz archive.
 


**Output**

A fast5.tar.gz archive

</help>

<citations>
    <citation type="doi">10.1101/2020.06.18.160010</citation>
</citations>
</tool>
