<tool id="filter_cells" name="filter cells data" version="0.1.0">
    <description>on total aligned reads and/or number of detected genes</description>
    <requirements>
        <requirement type="package" version="1.3.2=r3.3.2_0">r-optparse</requirement>
        <requirement type="package" version="2.2.1=r3.3.2_0">r-ggplot2</requirement>
    </requirements>
    <stdio>
        <exit_code range="1:" level="fatal" description="Tool exception" />
    </stdio>
    <command detect_errors="exit_code"><![CDATA[ 
        Rscript $__tool_directory__/filter_cells.R 
            -f $input 
            --sep 
            #if $sep == 'tab':
              'tab'
            #elif $sep == 'comma':
              'comma'
            #end if
            --percentile_genes '$percentile_genes'
            --percentile_counts '$percentile_counts'
            --absolute_genes '$absolute_genes'
            --absolute_counts '$absolute_counts'
            --pdfplot $pdfplot
            --output $output
            --output_metada $output_metada
]]></command>
    <inputs>
        <param name="input" type="data" format="txt" label="Raw counts of expression data"/>
        <param name="sep" type="select" label="Indicate column separator">
            <option value="tab" selected="true">Tabs</option>
            <option value="comma">Comma</option>
        </param>
        <param name="percentile_genes" value="0" type="integer" label="Detected Genes Percentile Threshold [integer] %"
               help="Cells with % of detected genes below this threshold will be filtered out. Leave at 0 for no filtering" />
        <param name="percentile_counts" value="0" type="integer" label="Aligned read count Percentile Threshold [integer] %"
               help="Cells with number of aligned reads below this % threshold will be filtered out. Leave at 0 for no filtering" />
        <param name="absolute_genes" value="0" type="integer" label="Absolute number of Detected Genes Threshold [integer]"
               help="Cells with number of detected genes below this threshold will be filtered out. Leave at 0 for no filtering" />
        <param name="absolute_counts" value="0" type="integer" label="Absolute number of aligned read Threshold [integer]"
               help="Cells with number of aligned reads below this absolute threshold will be filtered out. Leave at 0 for no filtering" />
    </inputs>
    <outputs>
        <data name="pdfplot" format="pdf" label="Plots from ${on_string}" />
        <data name="output" format="tabular" label="Cell data filtered with ${on_string}" />
        <data name="output_metada" format="tabular" label="Cell metadata filtered with ${on_string}" />
    </outputs>
    <tests>
        <test>
            <param name="input" value="input.csv" ftype="txt"/>
            <param name="sep" value='comma' />
            <param name="percentile_genes" value="20"/>
            <param name="percentile_counts" value="20"/>
            <output name="pdfplot" file="percentile_gene-and-counts.pdf" ftype="pdf"/>
            <output name="output" file="percentile_gene-and-counts.tab" ftype="tabular"/>
            <output name="output_metada" file="percentile_gene-and-counts.meta" ftype="tabular"/>
        </test>
        <test>
            <param name="input" value="input.tsv" ftype="txt"/>
            <param name="sep" value='tab' />
            <param name="percentile_genes" value="20"/>
            <param name="percentile_counts" value="20"/>
            <output name="pdfplot" file="percentile_gene-and-counts.pdf" ftype="pdf"/>
            <output name="output" file="percentile_gene-and-counts.tab" ftype="tabular"/>
            <output name="output_metada" file="percentile_gene-and-counts.meta" ftype="tabular"/>
        </test>
        <test>
            <param name="input" value="input.csv" ftype="txt"/>
            <param name="sep" value='comma' />
            <param name="percentile_genes" value="20"/>
            <output name="pdfplot" file="percentile_gene-only.pdf" ftype="pdf"/>
            <output name="output" file="percentile_gene-only.tab" ftype="tabular"/>
            <output name="output_metada" file="percentile_gene-only.meta" ftype="tabular"/>
        </test>
        <test>
            <param name="input" value="input.csv" ftype="txt"/>
            <param name="sep" value='comma' />
            <param name="percentile_counts" value="20"/>
            <output name="pdfplot" file="percentile_counts-only.pdf" ftype="pdf"/>
            <output name="output" file="percentile_counts-only.tab" ftype="tabular"/>
            <output name="output_metada" file="percentile_counts-only.meta" ftype="tabular"/>
        </test>
        <test>
            <param name="input" value="input.csv" ftype="txt"/>
            <param name="sep" value='comma' />
            <output name="pdfplot" file="no-filtering.pdf" ftype="pdf"/>
            <output name="output" file="no-filtering.tab" ftype="tabular"/>
            <output name="output_metada" file="no-filtering.meta" ftype="tabular"/>
        </test>
        <test>
            <param name="input" value="input.csv" ftype="txt"/>
            <param name="sep" value='comma' />
            <param name="absolute_genes" value="5"/>
            <param name="absolute_counts" value="1000"/>
            <output name="pdfplot" file="absolute_gene-and-counts.pdf" ftype="pdf"/>
            <output name="output" file="absolute_gene-and-counts.tab" ftype="tabular"/>
            <output name="output_metada" file="absolute_gene-and-counts.meta" ftype="tabular"/>
        </test>
        <test>
            <param name="input" value="input.csv" ftype="txt"/>
            <param name="sep" value='comma' />
            <param name="absolute_genes" value="5"/>
            <output name="pdfplot" file="absolute_gene-only.pdf" ftype="pdf"/>
            <output name="output" file="absolute_gene-only.tab" ftype="tabular"/>
            <output name="output_metada" file="absolute_gene-only.meta" ftype="tabular"/>
        </test>
        <test>
            <param name="input" value="input.csv" ftype="txt"/>
            <param name="sep" value='comma' />
            <param name="absolute_counts" value="1000"/>
            <output name="pdfplot" file="absolute_counts-only.pdf" ftype="pdf"/>
            <output name="output" file="absolute_counts-only.tab" ftype="tabular"/>
            <output name="output_metada" file="absolute_counts-only.meta" ftype="tabular"/>
        </test>
    </tests>
    <help>

**What it does**


    </help>
</tool>
